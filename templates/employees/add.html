{% extends "base.html" %}

{% block title %}Add Employee - Sakina Gas Company{% endblock %}

{% block extra_css %}
<style>
    .form-wizard {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        overflow: hidden;
    }
    
    .wizard-header {
        background: linear-gradient(135deg, var(--sakina-orange) 0%, #FF8C5A 100%);
        color: white;
        padding: 25px 30px;
    }
    
    .wizard-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin: 0;
    }
    
    .wizard-subtitle {
        opacity: 0.9;
        margin: 5px 0 0 0;
    }
    
    .wizard-steps {
        background: #f8f9fa;
        padding: 20px 30px;
        border-bottom: 1px solid #e9ecef;
    }
    
    .step-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
    }
    
    .step {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        border-radius: 25px;
        background: white;
        color: #6c757d;
        font-weight: 500;
        transition: all 0.3s ease;
        min-width: 150px;
        justify-content: center;
    }
    
    .step.active {
        background: var(--sakina-orange);
        color: white;
        transform: scale(1.05);
    }
    
    .step.completed {
        background: #28A745;
        color: white;
    }
    
    .step-number {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        font-weight: 700;
    }
    
    .wizard-body {
        padding: 30px;
    }
    
    .step-content {
        display: none;
    }
    
    .step-content.active {
        display: block;
        animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .section-title {
        color: var(--sakina-blue);
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        font-weight: 600;
        color: var(--sakina-blue);
        margin-bottom: 8px;
    }
    
    .required {
        color: #dc3545;
    }
    
    .form-control,
    .form-select {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 12px 15px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus,
    .form-select:focus {
        border-color: var(--sakina-orange);
        box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.15);
    }
    
    .form-control.is-valid {
        border-color: #28A745;
        background-image: none;
    }
    
    .form-control.is-invalid {
        border-color: #dc3545;
        background-image: none;
    }
    
    .help-text {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 5px;
    }
    
    .wizard-actions {
        background: #f8f9fa;
        padding: 20px 30px;
        border-top: 1px solid #e9ecef;
        display: flex;
        justify-content: between;
        gap: 15px;
    }
    
    .btn-wizard {
        padding: 12px 30px;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-prev {
        background: #6c757d;
        color: white;
        border: none;
    }
    
    .btn-prev:hover {
        background: #5a6268;
        color: white;
    }
    
    .btn-next,
    .btn-submit {
        background: linear-gradient(135deg, var(--sakina-orange) 0%, #FF8C5A 100%);
        color: white;
        border: none;
    }
    
    .btn-next:hover,
    .btn-submit:hover {
        background: linear-gradient(135deg, #e85a2e 0%, #e67a4d 100%);
        color: white;
        transform: translateY(-2px);
    }
    
    .preview-card {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
    }
    
    .preview-section {
        margin-bottom: 25px;
    }
    
    .preview-section h6 {
        color: var(--sakina-blue);
        font-weight: 600;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--sakina-orange);
    }
    
    .preview-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .preview-item:last-child {
        border-bottom: none;
    }
    
    .preview-label {
        font-weight: 500;
        color: #6c757d;
    }
    
    .preview-value {
        font-weight: 600;
        color: var(--sakina-dark-blue);
    }
    
    .avatar-preview {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--sakina-orange) 0%, #FF8C5A 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
        font-weight: 700;
        margin: 0 auto 15px;
    }
    
    @media (max-width: 768px) {
        .step-indicator {
            gap: 10px;
        }
        
        .step {
            min-width: 120px;
            padding: 8px 15px;
        }
        
        .wizard-body {
            padding: 20px;
        }
        
        .wizard-actions {
            padding: 15px 20px;
            flex-direction: column;
        }
        
        .btn-wizard {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-xl-10">
            <form method="POST" action="{{ url_for('employees.add_employee') }}" id="addEmployeeForm" novalidate>
                <!-- CSRF Protection FIX -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="form-wizard">
                    <!-- Wizard Header -->
                    <div class="wizard-header">
                        <h1 class="wizard-title">
                            <i class="bi bi-person-plus"></i> Add New Employee
                        </h1>
                        <p class="wizard-subtitle">Complete all steps to add a new employee to the system</p>
                    </div>
                    
                    <!-- Step Indicators -->
                    <div class="wizard-steps">
                        <div class="step-indicator">
                            <div class="step active" data-step="1">
                                <div class="step-number">1</div>
                                <span>Personal Info</span>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-number">2</div>
                                <span>Employment</span>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-number">3</div>
                                <span>Contact & Address</span>
                            </div>
                            <div class="step" data-step="4">
                                <div class="step-number">4</div>
                                <span>Banking & Legal</span>
                            </div>
                            <div class="step" data-step="5">
                                <div class="step-number">5</div>
                                <span>Review & Submit</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wizard Body -->
                    <div class="wizard-body">
                        <!-- Step 1: Personal Information -->
                        <div class="step-content active" id="step1">
                            <div class="section-title">
                                <i class="bi bi-person-circle"></i>
                                Personal Information
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">First Name <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="first_name" required
                                               value="{{ form_data.first_name if form_data else '' }}"
                                               placeholder="Enter first name">
                                        <div class="invalid-feedback">Please provide a valid first name.</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Middle Name</label>
                                        <input type="text" class="form-control" name="middle_name"
                                               value="{{ form_data.middle_name if form_data else '' }}"
                                               placeholder="Enter middle name (optional)">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Last Name <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="last_name" required
                                               value="{{ form_data.last_name if form_data else '' }}"
                                               placeholder="Enter last name">
                                        <div class="invalid-feedback">Please provide a valid last name.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Date of Birth</label>
                                        <input type="date" class="form-control" name="date_of_birth"
                                               value="{{ form_data.date_of_birth if form_data else '' }}"
                                               max="{{ (moment().subtract(18, 'years').format('YYYY-MM-DD')) if moment else '2006-01-01' }}">
                                        <div class="help-text">Employee must be at least 18 years old</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Gender</label>
                                        <select class="form-select" name="gender">
                                            <option value="">Select Gender</option>
                                            <option value="male" {% if form_data and form_data.gender == 'male' %}selected{% endif %}>Male</option>
                                            <option value="female" {% if form_data and form_data.gender == 'female' %}selected{% endif %}>Female</option>
                                            <option value="other" {% if form_data and form_data.gender == 'other' %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Marital Status</label>
                                        <select class="form-select" name="marital_status">
                                            <option value="">Select Status</option>
                                            <option value="single" {% if form_data and form_data.marital_status == 'single' %}selected{% endif %}>Single</option>
                                            <option value="married" {% if form_data and form_data.marital_status == 'married' %}selected{% endif %}>Married</option>
                                            <option value="divorced" {% if form_data and form_data.marital_status == 'divorced' %}selected{% endif %}>Divorced</option>
                                            <option value="widowed" {% if form_data and form_data.marital_status == 'widowed' %}selected{% endif %}>Widowed</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">National ID <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="national_id" required
                                               value="{{ form_data.national_id if form_data else '' }}"
                                               placeholder="Enter National ID number">
                                        <div class="help-text">Valid Kenyan National ID (7-8 digits)</div>
                                        <div class="invalid-feedback">Please provide a valid National ID.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Nationality</label>
                                        <input type="text" class="form-control" name="nationality" 
                                               value="{{ form_data.nationality if form_data else 'Kenyan' }}"
                                               placeholder="Enter nationality">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 2: Employment Information -->
                        <div class="step-content" id="step2">
                            <div class="section-title">
                                <i class="bi bi-briefcase"></i>
                                Employment Information
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Location <span class="required">*</span></label>
                                        <select class="form-select" name="location" required>
                                            <option value="">Select Location</option>
                                            {% for location in locations %}
                                                <option value="{{ location }}" {% if form_data and form_data.location == location %}selected{% endif %}>
                                                    {{ location|replace('_', ' ')|title }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">Please select a location.</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Department <span class="required">*</span></label>
                                        <select class="form-select" name="department" required>
                                            <option value="">Select Department</option>
                                            {% for department in departments %}
                                                <option value="{{ department }}" {% if form_data and form_data.department == department %}selected{% endif %}>
                                                    {{ department|replace('_', ' ')|title }}
                                                </option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">Please select a department.</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Employment Type</label>
                                        <select class="form-select" name="employment_type">
                                            <option value="permanent" {% if form_data and form_data.employment_type == 'permanent' %}selected{% endif %}>Permanent</option>
                                            <option value="contract" {% if form_data and form_data.employment_type == 'contract' %}selected{% endif %}>Contract</option>
                                            <option value="casual" {% if form_data and form_data.employment_type == 'casual' %}selected{% endif %}>Casual</option>
                                            <option value="intern" {% if form_data and form_data.employment_type == 'intern' %}selected{% endif %}>Intern</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Position/Job Title <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="position" required
                                               value="{{ form_data.position if form_data else '' }}"
                                               placeholder="e.g., Sales Manager, Attendant, Security Guard">
                                        <div class="invalid-feedback">Please provide a job position.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Official Job Title</label>
                                        <input type="text" class="form-control" name="job_title"
                                               value="{{ form_data.job_title if form_data else '' }}"
                                               placeholder="Official title as per contract">
                                    </div>
                                end of file