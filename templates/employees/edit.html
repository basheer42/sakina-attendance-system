{% extends "base.html" %}

{% block title %}Edit Employee - {{ employee.get_full_name() }}{% endblock %}

{% block extra_css %}
<style>
    .form-wizard {
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        overflow: hidden;
    }
    
    .wizard-header {
        background: linear-gradient(135deg, var(--sakina-orange) 0%, #FF8C5A 100%);
        color: white;
        padding: 25px 30px;
    }
    
    .wizard-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin: 0;
    }
    
    .wizard-subtitle {
        opacity: 0.9;
        margin: 5px 0 0 0;
    }
    
    .wizard-steps {
        background: #f8f9fa;
        padding: 20px 30px;
        border-bottom: 1px solid #e9ecef;
    }
    
    .step-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
    }
    
    .step {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 20px;
        border-radius: 25px;
        background: white;
        color: #6c757d;
        font-weight: 500;
        transition: all 0.3s ease;
        min-width: 150px;
        justify-content: center;
        cursor: pointer;
    }
    
    .step.active {
        background: var(--sakina-orange);
        color: white;
        transform: scale(1.05);
    }
    
    .step.completed {
        background: #28A745;
        color: white;
    }
    
    .step-number {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        font-weight: 700;
    }
    
    .wizard-body {
        padding: 30px;
    }
    
    .step-content {
        display: none;
    }
    
    .step-content.active {
        display: block;
        animation: fadeIn 0.5s ease;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .section-title {
        color: var(--sakina-blue);
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        font-weight: 600;
        color: var(--sakina-blue);
        margin-bottom: 8px;
    }
    
    .required {
        color: #dc3545;
    }
    
    .form-control,
    .form-select {
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 12px 15px;
        transition: all 0.3s ease;
    }
    
    .form-control:focus,
    .form-select:focus {
        border-color: var(--sakina-orange);
        box-shadow: 0 0 0 0.2rem rgba(255, 107, 53, 0.15);
    }
    
    .form-control.is-valid {
        border-color: #28A745;
        background-image: none;
    }
    
    .form-control.is-invalid {
        border-color: #dc3545;
        background-image: none;
    }
    
    .help-text {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 5px;
    }
    
    .wizard-actions {
        background: #f8f9fa;
        padding: 20px 30px;
        border-top: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        gap: 15px;
    }
    
    .btn-wizard {
        padding: 12px 30px;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-prev {
        background: #6c757d;
        color: white;
        border: none;
    }
    
    .btn-prev:hover {
        background: #5a6268;
        color: white;
    }
    
    .btn-next,
    .btn-submit {
        background: linear-gradient(135deg, var(--sakina-blue) 0%, var(--sakina-light-blue) 100%);
        color: white;
        border: none;
    }
    
    .btn-next:hover,
    .btn-submit:hover {
        background: linear-gradient(135deg, var(--sakina-blue) 0%, #0066a3 100%);
        color: white;
        transform: translateY(-2px);
    }
    
    .preview-card {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
    }
    
    .preview-section {
        margin-bottom: 25px;
    }
    
    .preview-section h6 {
        color: var(--sakina-blue);
        font-weight: 600;
        margin-bottom: 15px;
        padding-bottom: 8px;
        border-bottom: 2px solid var(--sakina-orange);
    }
    
    .preview-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .preview-item:last-child {
        border-bottom: none;
    }
    
    .preview-label {
        font-weight: 500;
        color: #6c757d;
    }
    
    .preview-value {
        font-weight: 600;
        color: var(--sakina-dark-blue);
    }
    
    .avatar-preview {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--sakina-orange) 0%, #FF8C5A 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
        font-weight: 700;
        margin: 0 auto 15px;
    }
    
    @media (max-width: 768px) {
        .step-indicator {
            gap: 10px;
        }
        
        .step {
            min-width: 120px;
            padding: 8px 15px;
        }
        
        .wizard-body {
            padding: 20px;
        }
        
        .wizard-actions {
            padding: 15px 20px;
            flex-direction: column;
        }
        
        .btn-wizard {
            width: 100%;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-xl-10">
            <!-- Form action points to the edit_employee route with the employee ID -->
            <form method="POST" action="{{ url_for('employees.edit_employee', id=employee.id) }}" id="editEmployeeForm" novalidate>
                <!-- CSRF Protection -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="form-wizard">
                    <!-- Wizard Header -->
                    <div class="wizard-header">
                        <h1 class="wizard-title">
                            <i class="bi bi-pencil-square"></i> Edit Employee: {{ employee.get_full_name() }}
                        </h1>
                        <p class="wizard-subtitle">Update and review the employee's information</p>
                    </div>
                    
                    <!-- Step Indicators -->
                    <div class="wizard-steps">
                        <div class="step-indicator">
                            <div class="step active" data-step="1">
                                <div class="step-number">1</div>
                                <span>Personal Info</span>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-number">2</div>
                                <span>Employment</span>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-number">3</div>
                                <span>Contact & Address</span>
                            </div>
                            <div class="step" data-step="4">
                                <div class="step-number">4</div>
                                <span>Banking & Legal</span>
                            </div>
                            <div class="step" data-step="5">
                                <div class="step-number">5</div>
                                <span>Review & Save</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wizard Body -->
                    <div class="wizard-body">
                        <!-- Step 1: Personal Information -->
                        <div class="step-content active" id="step1">
                            <div class="section-title">
                                <i class="bi bi-person-circle"></i>
                                Personal Information
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">First Name <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="first_name" required
                                               value="{{ employee.first_name or '' }}"
                                               placeholder="Enter first name">
                                        <div class="invalid-feedback">Please provide a valid first name.</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Middle Name</label>
                                        <input type="text" class="form-control" name="middle_name"
                                               value="{{ employee.middle_name or '' }}"
                                               placeholder="Enter middle name (optional)">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Last Name <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="last_name" required
                                               value="{{ employee.last_name or '' }}"
                                               placeholder="Enter last name">
                                        <div class="invalid-feedback">Please provide a valid last name.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Date of Birth</label>
                                        <input type="date" class="form-control" name="date_of_birth"
                                               value="{{ employee.date_of_birth.strftime('%Y-%m-%d') if employee.date_of_birth else '' }}"
                                               max="2006-01-01">
                                        <div class="help-text">Employee must be at least 18 years old</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Gender</label>
                                        <select class="form-select" name="gender">
                                            <option value="">Select Gender</option>
                                            {% for key, display in form_data.genders %}
                                                <option value="{{ key }}" {% if employee.gender == key %}selected{% endif %}>{{ display }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Marital Status</label>
                                        <select class="form-select" name="marital_status">
                                            <option value="">Select Status</option>
                                            {% for key, display in form_data.marital_statuses %}
                                                <option value="{{ key }}" {% if employee.marital_status == key %}selected{% endif %}>{{ display }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">National ID <span class="required">*</span></label>
                                        <!-- National ID field should be editable if not being validated against unique constraint in Python backend -->
                                        <input type="text" class="form-control" name="national_id" required
                                               value="{{ employee.national_id or '' }}"
                                               placeholder="Enter National ID number">
                                        <div class="help-text">Valid Kenyan National ID (7-8 digits)</div>
                                        <div class="invalid-feedback">Please provide a valid National ID.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Nationality</label>
                                        <input type="text" class="form-control" name="nationality" 
                                               value="{{ employee.nationality or 'Kenyan' }}"
                                               placeholder="Enter nationality">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 2: Employment Information -->
                        <div class="step-content" id="step2">
                            <div class="section-title">
                                <i class="bi bi-briefcase"></i>
                                Employment Information
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Employee ID <span class="required">*</span></label>
                                        <!-- Employee ID should generally not be editable after creation, making it readonly -->
                                        <input type="text" class="form-control" name="employee_id" required readonly
                                               value="{{ employee.employee_id or '' }}">
                                        <div class="help-text">Unique employee identifier (Read-only)</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Location <span class="required">*</span></label>
                                        <select class="form-select" name="location" required>
                                            <option value="">Select Location</option>
                                            {% for key, display in form_data.locations.items() %}
                                                <option value="{{ key }}" {% if employee.location == key %}selected{% endif %}>{{ display }}</option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">Please select a location.</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Department <span class="required">*</span></label>
                                        <select class="form-select" name="department" required>
                                            <option value="">Select Department</option>
                                            {% for key, display in form_data.departments.items() %}
                                                <option value="{{ key }}" {% if employee.department == key %}selected{% endif %}>{{ display }}</option>
                                            {% endfor %}
                                        </select>
                                        <div class="invalid-feedback">Please select a department.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Employment Type</label>
                                        <select class="form-select" name="employment_type">
                                            {% for key, display in form_data.employment_types %}
                                                <option value="{{ key }}" {% if employee.employment_type == key %}selected{% endif %}>{{ display }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Shift</label>
                                        <select class="form-select" name="shift">
                                            {% for key, display in form_data.shifts %}
                                                <option value="{{ key }}" {% if employee.shift == key %}selected{% endif %}>{{ display }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Hire Date <span class="required">*</span></label>
                                        <input type="date" class="form-control" name="hire_date" required
                                               value="{{ employee.hire_date.strftime('%Y-%m-%d') if employee.hire_date else '' }}">
                                        <div class="invalid-feedback">Please provide a hire date.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Position/Job Title <span class="required">*</span></label>
                                        <input type="text" class="form-control" name="position" required
                                               value="{{ employee.position or '' }}"
                                               placeholder="e.g., Station Attendant, Security Guard">
                                        <div class="invalid-feedback">Please provide a job position.</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Official Job Title</label>
                                        <!-- Note: employee model doesn't seem to have a 'job_title', but the add form had it, sticking to 'position' for now -->
                                        <input type="text" class="form-control" name="job_title"
                                               value="{{ employee.position or '' }}"
                                               placeholder="Official title as per contract">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 3: Contact & Address -->
                        <div class="step-content" id="step3">
                            <div class="section-title">
                                <i class="bi bi-geo-alt"></i>
                                Contact & Address Information
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Email Address</label>
                                        <input type="email" class="form-control" name="email"
                                               value="{{ employee.email or '' }}"
                                               placeholder="employee@example.com">
                                        <div class="help-text">Work email address (optional)</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Phone Number <span class="required">*</span></label>
                                        <input type="tel" class="form-control" name="phone_number" required
                                               value="{{ employee.phone_number or '' }}"
                                               placeholder="0712345678">
                                        <div class="help-text">Kenyan mobile number format</div>
                                        <div class="invalid-feedback">Please provide a valid phone number.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-12">
                                    <div class="form-group">
                                        <label class="form-label">Residential Address</label>
                                        <textarea class="form-control" name="address" rows="3"
                                                  placeholder="Enter full residential address">{{ employee.address or '' }}</textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="section-title mt-4">
                                <i class="bi bi-telephone"></i>
                                Emergency Contact
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Emergency Contact Name</label>
                                        <input type="text" class="form-control" name="emergency_contact_name"
                                               value="{{ employee.emergency_contact_name or '' }}"
                                               placeholder="Full name">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Emergency Contact Phone</label>
                                        <input type="tel" class="form-control" name="emergency_contact_phone"
                                               value="{{ employee.emergency_contact_phone or '' }}"
                                               placeholder="0712345678">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Relationship</label>
                                        <select class="form-select" name="emergency_contact_relationship">
                                            <option value="">Select Relationship</option>
                                            <option value="spouse" {% if employee.emergency_contact_relationship == 'spouse' %}selected{% endif %}>Spouse</option>
                                            <option value="parent" {% if employee.emergency_contact_relationship == 'parent' %}selected{% endif %}>Parent</option>
                                            <option value="sibling" {% if employee.emergency_contact_relationship == 'sibling' %}selected{% endif %}>Sibling</option>
                                            <option value="child" {% if employee.emergency_contact_relationship == 'child' %}selected{% endif %}>Child</option>
                                            <option value="friend" {% if employee.emergency_contact_relationship == 'friend' %}selected{% endif %}>Friend</option>
                                            <option value="other" {% if employee.emergency_contact_relationship == 'other' %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 4: Banking & Legal -->
                        <div class="step-content" id="step4">
                            <div class="section-title">
                                <i class="bi bi-bank"></i>
                                Banking Information
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Bank Name</label>
                                        <select class="form-select" name="bank_name">
                                            <option value="">Select Bank</option>
                                            <option value="kcb" {% if employee.bank_name == 'kcb' %}selected{% endif %}>KCB Bank</option>
                                            <option value="equity" {% if employee.bank_name == 'equity' %}selected{% endif %}>Equity Bank</option>
                                            <option value="cooperative" {% if employee.bank_name == 'cooperative' %}selected{% endif %}>Co-operative Bank</option>
                                            <option value="absa" {% if employee.bank_name == 'absa' %}selected{% endif %}>ABSA Bank</option>
                                            <option value="stanbic" {% if employee.bank_name == 'stanbic' %}selected{% endif %}>Stanbic Bank</option>
                                            <option value="ncba" {% if employee.bank_name == 'ncba' %}selected{% endif %}>NCBA Bank</option>
                                            <option value="standard_chartered" {% if employee.bank_name == 'standard_chartered' %}selected{% endif %}>Standard Chartered</option>
                                            <option value="dtb" {% if employee.bank_name == 'dtb' %}selected{% endif %}>DTB Bank</option>
                                            <option value="family" {% if employee.bank_name == 'family' %}selected{% endif %}>Family Bank</option>
                                            <option value="mpesa" {% if employee.bank_name == 'mpesa' %}selected{% endif %}>M-Pesa (Paybill)</option>
                                            <option value="other" {% if employee.bank_name == 'other' %}selected{% endif %}>Other</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Account Number</label>
                                        <input type="text" class="form-control" name="account_number"
                                               value="{{ employee.account_number or '' }}"
                                               placeholder="Enter account number">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Bank Branch</label>
                                        <input type="text" class="form-control" name="bank_branch"
                                               value="{{ employee.bank_branch or '' }}"
                                               placeholder="Enter bank branch">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="section-title mt-4">
                                <i class="bi bi-cash-stack"></i>
                                Salary & Allowances
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Basic Salary (KES) <span class="required">*</span></label>
                                        <input type="number" class="form-control" name="basic_salary" required
                                               value="{{ employee.basic_salary or '' }}"
                                               placeholder="e.g., 25000" min="0" step="100">
                                        <div class="invalid-feedback">Please provide a valid salary amount.</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Transport Allowance (KES)</label>
                                        <input type="number" class="form-control" name="transport_allowance"
                                               value="{{ employee.allowances.transport or '' }}"
                                               placeholder="e.g., 3000" min="0" step="100">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">Housing Allowance (KES)</label>
                                        <input type="number" class="form-control" name="housing_allowance"
                                               value="{{ employee.allowances.housing or '' }}"
                                               placeholder="e.g., 5000" min="0" step="100">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="section-title mt-4">
                                <i class="bi bi-file-earmark-text"></i>
                                Legal & Statutory
                            </div>
                            
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">KRA PIN</label>
                                        <input type="text" class="form-control" name="kra_pin"
                                               value="{{ employee.kra_pin or '' }}"
                                               placeholder="e.g., A123456789B">
                                        <div class="help-text">Kenya Revenue Authority PIN</div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">NSSF Number</label>
                                        <input type="text" class="form-control" name="nssf_number"
                                               value="{{ employee.nssf_number or '' }}"
                                               placeholder="Enter NSSF number">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label class="form-label">NHIF Number</label>
                                        <input type="text" class="form-control" name="nhif_number"
                                               value="{{ employee.nhif_number or '' }}"
                                               placeholder="Enter NHIF number">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Step 5: Review & Save -->
                        <div class="step-content" id="step5">
                            <div class="section-title">
                                <i class="bi bi-check-circle"></i>
                                Review Employee Information
                            </div>
                            
                            <div class="alert alert-warning">
                                <i class="bi bi-info-circle"></i>
                                Changes made in the form below will override the current information. Please review all fields before clicking 'Save Changes'.
                            </div>
                            
                            <div class="preview-card">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="preview-section">
                                            <h6><i class="bi bi-person"></i> Personal Information</h6>
                                            <div class="preview-item">
                                                <span class="preview-label">Full Name:</span>
                                                <span class="preview-value" id="preview-name">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Date of Birth:</span>
                                                <span class="preview-value" id="preview-dob">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Gender:</span>
                                                <span class="preview-value" id="preview-gender">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">National ID:</span>
                                                <span class="preview-value" id="preview-national-id">-</span>
                                            </div>
                                        </div>
                                        
                                        <div class="preview-section">
                                            <h6><i class="bi bi-briefcase"></i> Employment Details</h6>
                                            <div class="preview-item">
                                                <span class="preview-label">Employee ID:</span>
                                                <span class="preview-value">{{ employee.employee_id or '-' }}</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Position:</span>
                                                <span class="preview-value" id="preview-position">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Department:</span>
                                                <span class="preview-value" id="preview-department">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Location:</span>
                                                <span class="preview-value" id="preview-location">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Hire Date:</span>
                                                <span class="preview-value" id="preview-hire-date">-</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="preview-section">
                                            <h6><i class="bi bi-telephone"></i> Contact Information</h6>
                                            <div class="preview-item">
                                                <span class="preview-label">Phone:</span>
                                                <span class="preview-value" id="preview-phone">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Email:</span>
                                                <span class="preview-value" id="preview-email">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Emergency Contact:</span>
                                                <span class="preview-value" id="preview-emergency">-</span>
                                            </div>
                                        </div>
                                        
                                        <div class="preview-section">
                                            <h6><i class="bi bi-cash-stack"></i> Salary & Banking</h6>
                                            <div class="preview-item">
                                                <span class="preview-label">Basic Salary:</span>
                                                <span class="preview-value" id="preview-salary">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Bank:</span>
                                                <span class="preview-value" id="preview-bank">-</span>
                                            </div>
                                            <div class="preview-item">
                                                <span class="preview-label">Account:</span>
                                                <span class="preview-value" id="preview-account">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Wizard Actions -->
                    <div class="wizard-actions">
                        <button type="button" class="btn btn-wizard btn-prev" id="prevBtn" style="display: none;">
                            <i class="bi bi-arrow-left"></i> Previous
                        </button>
                        <div class="ms-auto d-flex gap-2">
                            <a href="{{ url_for('employees.view_employee', id=employee.id) }}" class="btn btn-outline-secondary btn-wizard">
                                <i class="bi bi-x-lg"></i> Cancel
                            </a>
                            <button type="button" class="btn btn-wizard btn-next" id="nextBtn">
                                Next <i class="bi bi-arrow-right"></i>
                            </button>
                            <button type="submit" class="btn btn-wizard btn-submit" id="submitBtn" style="display: none;">
                                <i class="bi bi-save"></i> Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    let currentStep = 1;
    const totalSteps = 5;
    
    const steps = document.querySelectorAll('.step');
    const stepContents = document.querySelectorAll('.step-content');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const form = document.getElementById('editEmployeeForm');
    
    function showStep(step) {
        // Update step indicators
        steps.forEach((s, index) => {
            s.classList.remove('active', 'completed');
            if (index + 1 < step) {
                s.classList.add('completed');
            } else if (index + 1 === step) {
                s.classList.add('active');
            }
        });
        
        // Update step content
        stepContents.forEach((content, index) => {
            content.classList.remove('active');
            if (index + 1 === step) {
                content.classList.add('active');
            }
        });
        
        // Update buttons
        prevBtn.style.display = step > 1 ? 'block' : 'none';
        
        if (step === totalSteps) {
            nextBtn.style.display = 'none';
            submitBtn.style.display = 'block';
            updatePreview();
        } else {
            nextBtn.style.display = 'block';
            submitBtn.style.display = 'none';
        }
        
        currentStep = step;
        
        // Scroll to top of form
        document.querySelector('.form-wizard').scrollIntoView({ behavior: 'smooth' });
    }
    
    function validateStep(step) {
        const currentContent = document.getElementById('step' + step);
        const requiredFields = currentContent.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim() && !field.readOnly) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
                field.classList.add('is-valid');
            }
        });
        
        return isValid;
    }
    
    function updatePreview() {
        // Utility function to get display text from a select field
        const getSelectDisplayText = (name) => {
            const select = document.querySelector(`[name="${name}"]`);
            return select.options[select.selectedIndex]?.text || '-';
        };

        // Utility function to get text value
        const getInputValue = (name) => document.querySelector(`[name="${name}"]`)?.value || '-';

        // Personal Info
        const firstName = getInputValue('first_name');
        const middleName = getInputValue('middle_name');
        const lastName = getInputValue('last_name');
        document.getElementById('preview-name').textContent = `${firstName} ${middleName} ${lastName}`.trim() || '-';
        
        document.getElementById('preview-dob').textContent = getInputValue('date_of_birth');
        document.getElementById('preview-gender').textContent = getSelectDisplayText('gender');
        document.getElementById('preview-national-id').textContent = getInputValue('national_id');
        
        // Employment Info
        document.getElementById('preview-position').textContent = getInputValue('position');
        document.getElementById('preview-department').textContent = getSelectDisplayText('department');
        document.getElementById('preview-location').textContent = getSelectDisplayText('location');
        document.getElementById('preview-hire-date').textContent = getInputValue('hire_date');
        
        // Contact Info
        document.getElementById('preview-phone').textContent = getInputValue('phone_number');
        document.getElementById('preview-email').textContent = getInputValue('email');
        
        const emergencyName = getInputValue('emergency_contact_name');
        const emergencyPhone = getInputValue('emergency_contact_phone');
        document.getElementById('preview-emergency').textContent = emergencyName ? `${emergencyName} (${emergencyPhone})` : '-';
        
        // Salary & Banking
        const salary = getInputValue('basic_salary');
        document.getElementById('preview-salary').textContent = salary ? `KES ${parseInt(salary).toLocaleString()}` : '-';
        
        document.getElementById('preview-bank').textContent = getSelectDisplayText('bank_name');
        document.getElementById('preview-account').textContent = getInputValue('account_number');
    }
    
    // Event Listeners
    nextBtn.addEventListener('click', function() {
        if (validateStep(currentStep)) {
            if (currentStep < totalSteps) {
                showStep(currentStep + 1);
            }
        }
    });
    
    prevBtn.addEventListener('click', function() {
        if (currentStep > 1) {
            showStep(currentStep - 1);
        }
    });
    
    // Click on step indicators
    steps.forEach((step, index) => {
        step.addEventListener('click', function() {
            const targetStep = index + 1;
            // Only allow going back or to completed steps
            if (targetStep < currentStep || this.classList.contains('completed')) {
                showStep(targetStep);
            }
        });
    });
    
    // Form validation on submit
    form.addEventListener('submit', function(e) {
        // Validate all steps before submit
        for (let i = 1; i <= totalSteps; i++) {
            if (!validateStep(i)) {
                e.preventDefault();
                showStep(i);
                return;
            }
        }
    });
    
    // Real-time validation
    document.querySelectorAll('.form-control, .form-select').forEach(field => {
        field.addEventListener('change', function() {
            if (this.hasAttribute('required')) {
                if (this.value.trim()) {
                    this.classList.remove('is-invalid');
                    this.classList.add('is-valid');
                } else {
                    this.classList.remove('is-valid');
                    this.classList.add('is-invalid');
                }
            }
        });
    });
    
    // Initialize
    showStep(1);
});
</script>
{% endblock %}