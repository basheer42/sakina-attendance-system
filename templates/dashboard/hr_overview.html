{% extends "base.html" %}

{% block title %}HR Overview - Sakina Gas Attendance System{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 text-sakina-dark fw-bold mb-0">
                        <i class="bi bi-speedometer2 text-sakina-primary me-2"></i>
                        HR Dashboard
                    </h1>
                    <p class="text-muted mb-0">Comprehensive overview for {{ today.strftime('%A, %B %d, %Y') }}</p>
                </div>
                <div class="text-end">
                    <span class="badge bg-success fs-6 px-3 py-2">
                        <i class="bi bi-person-check me-1"></i>
                        {{ current_user.full_name }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Stats Cards -->
    <div class="row g-4 mb-4">
        <div class="col-xl-3 col-lg-6">
            <div class="card card-sakina h-100 border-0 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-primary bg-gradient rounded-circle p-3">
                            <i class="bi bi-people text-white fs-4"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted text-uppercase mb-1">Total Employees</h6>
                        <h2 class="mb-0 fw-bold text-sakina-dark">{{ total_employees }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6">
            <div class="card card-sakina h-100 border-0 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-success bg-gradient rounded-circle p-3">
                            <i class="bi bi-check-circle text-white fs-4"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted text-uppercase mb-1">Present Today</h6>
                        <h2 class="mb-0 fw-bold text-success">{{ attendance_overview.present }}</h2>
                        <small class="text-muted">{{ attendance_overview.attendance_rate }}% attendance rate</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6">
            <div class="card card-sakina h-100 border-0 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-warning bg-gradient rounded-circle p-3">
                            <i class="bi bi-exclamation-triangle text-white fs-4"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted text-uppercase mb-1">Absent Today</h6>
                        <h2 class="mb-0 fw-bold text-warning">{{ attendance_overview.absent }}</h2>
                        <small class="text-muted">{{ attendance_overview.not_marked }} not marked</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-lg-6">
            <div class="card card-sakina h-100 border-0 shadow-sm">
                <div class="card-body d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="bg-info bg-gradient rounded-circle p-3">
                            <i class="bi bi-calendar-check text-white fs-4"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h6 class="text-muted text-uppercase mb-1">Pending Requests</h6>
                        <h2 class="mb-0 fw-bold text-info">{{ pending_items.leave_requests }}</h2>
                        <small class="text-muted">Leave approvals needed</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Left Column -->
        <div class="col-lg-8">
            <!-- Attendance Overview -->
            <div class="card card-sakina mb-4 border-0 shadow-sm">
                <div class="card-header-sakina">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-clock-history text-sakina-primary me-2"></i>
                        Today's Attendance Overview
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="border-end">
                                <h4 class="text-success fw-bold">{{ attendance_overview.present }}</h4>
                                <small class="text-muted">Present</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border-end">
                                <h4 class="text-warning fw-bold">{{ attendance_overview.late }}</h4>
                                <small class="text-muted">Late</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border-end">
                                <h4 class="text-danger fw-bold">{{ attendance_overview.absent }}</h4>
                                <small class="text-muted">Absent</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <h4 class="text-info fw-bold">{{ attendance_overview.on_leave }}</h4>
                            <small class="text-muted">On Leave</small>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <div class="progress" style="height: 10px;">
                            {% set total = attendance_overview.total_expected or 1 %}
                            <div class="progress-bar bg-success" style="width: {{ (attendance_overview.present / total * 100) }}%"></div>
                            <div class="progress-bar bg-warning" style="width: {{ (attendance_overview.late / total * 100) }}%"></div>
                            <div class="progress-bar bg-danger" style="width: {{ (attendance_overview.absent / total * 100) }}%"></div>
                            <div class="progress-bar bg-info" style="width: {{ (attendance_overview.on_leave / total * 100) }}%"></div>
                        </div>
                        <small class="text-muted mt-2 d-block">
                            <a href="{{ url_for('dashboard.attendance_details') }}" class="text-decoration-none">
                                <i class="bi bi-arrow-right me-1"></i>View detailed attendance
                            </a>
                        </small>
                    </div>
                </div>
            </div>

            <!-- Location Performance -->
            <div class="card card-sakina mb-4 border-0 shadow-sm">
                <div class="card-header-sakina">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-geo-alt text-sakina-primary me-2"></i>
                        Location Performance
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for location, metrics in location_performance.items() %}
                        <div class="col-md-6 mb-3">
                            <div class="border rounded p-3 bg-light">
                                <h6 class="fw-semibold text-capitalize mb-2">
                                    {{ location.replace('_', ' ').title() }}
                                </h6>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <small class="text-muted">Employees: {{ metrics.employee_count }}</small><br>
                                        <small class="text-muted">Attendance: {{ metrics.attendance_rate }}%</small>
                                    </div>
                                    <div class="text-end">
                                        {% if metrics.pending_leaves > 0 %}
                                        <span class="badge bg-warning">{{ metrics.pending_leaves }} pending</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
            <!-- Pending Approvals -->
            <div class="card card-sakina mb-4 border-0 shadow-sm">
                <div class="card-header-sakina">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-check2-square text-sakina-primary me-2"></i>
                        Pending Approvals
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0 border-0">
                            <div>
                                <i class="bi bi-calendar-check text-warning me-2"></i>
                                Leave Requests
                            </div>
                            <span class="badge bg-warning rounded-pill">{{ pending_items.leave_requests }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0 border-0">
                            <div>
                                <i class="bi bi-person-exclamation text-info me-2"></i>
                                Probation Reviews
                            </div>
                            <span class="badge bg-info rounded-pill">{{ pending_items.probation_reviews }}</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between align-items-center px-0 border-0">
                            <div>
                                <i class="bi bi-graph-up text-success me-2"></i>
                                Performance Reviews
                            </div>
                            <span class="badge bg-success rounded-pill">{{ pending_items.performance_reviews }}</span>
                        </div>
                    </div>
                    
                    <div class="mt-3 pt-3 border-top">
                        <a href="{{ url_for('leaves.list_leaves') }}" class="btn btn-sakina-primary btn-sm w-100">
                            <i class="bi bi-arrow-right me-1"></i>Manage All Requests
                        </a>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card card-sakina border-0 shadow-sm">
                <div class="card-header-sakina">
                    <h5 class="mb-0 fw-semibold">
                        <i class="bi bi-lightning text-sakina-primary me-2"></i>
                        Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <!-- SIMPLIFIED: Use simple paths instead of complex routing -->
                        <a href="/employees/add" class="btn btn-sakina-primary btn-sm">
                            <i class="bi bi-person-plus me-2"></i>Add Employee
                        </a>
                        <a href="/attendance/mark" class="btn btn-sakina-secondary btn-sm">
                            <i class="bi bi-clock me-2"></i>Mark Attendance
                        </a>
                        <a href="{{ url_for('leaves.list_leaves') }}" class="btn btn-outline-primary btn-sm">
                            <i class="bi bi-calendar-check me-2"></i>Approve Leaves
                        </a>
                        <a href="{{ url_for('dashboard.attendance_details') }}" class="btn btn-outline-secondary btn-sm">
                            <i class="bi bi-graph-up me-2"></i>View Reports
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Message -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">
                ðŸŽ‰ <strong>Success!</strong> Your Sakina Gas Attendance System is now fully operational!
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

<script>
// Show success toast on load
document.addEventListener('DOMContentLoaded', function() {
    var successToast = new bootstrap.Toast(document.getElementById('successToast'));
    successToast.show();
});

// Add smooth hover effects
document.querySelectorAll('.card-sakina').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-2px)';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
    });
});
</script>
{% endblock %}